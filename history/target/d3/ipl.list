     1                                  ORG   0x7c00          ; 引导区加载位置
     2                                                        ; 与之相对的详细内存分区可参考 http://www.bioscentral.com/misc/bda.htm
     3                                  
     4                                  ;--------------------------------------- FAT12 格式描述 ------------------------------------------
     5                                  ; FAT12 引导扇区格式参见 http://blog.sina.com.cn/s/blog_3edcf6b80100cr08.html
     6 00000000 EB4E                    JMP   entry
     7 00000002 90                      DB    0x90
     8 00000003 414E4F5349504C20        DB    "ANOSIPL "      ; OEM字符串，8字节（通常为格式化本磁盘的操作系统名称及版本）
     9 0000000B 0002                    DW    512             ; 每个扇区(sector)大小，必须为512(B)
    10 0000000D 01                      DB    1               ; 簇(cluster)的大小，必须为1（个扇区）
    11 0000000E 0100                    DW    1               ; FAT的起始扇区数（一般从第一个扇区开始）
    12 00000010 02                      DB    2               ; FAT的个数（必须为2）
    13 00000011 E000                    DW    224             ; 根目录的大小（一般设成224项）
    14 00000013 400B                    DW    2880            ; 该磁盘的大小（必须设成2880扇区，即1440KB）
    15 00000015 F0                      DB    0xf0            ; 磁盘的种类（必须为F0）
    16 00000016 0900                    DW    9               ; FAT的长度（必须是9扇区）
    17 00000018 1200                    DW    18              ; 每个磁道的扇区数（必须是18）
    18 0000001A 0200                    DW    2               ; 磁头数（必须是2）
    19 0000001C 00000000                DD    0               ; 不使用分区（必须是0）
    20 00000020 400B0000                DD    2880            ; 重写一次磁盘大小
    21 00000024 000029                  DB    0,0,0x29        ; 意义不名
    22 00000027 FFFFFFFF                DD    0xffffffff      ; （可能是）卷标号码
    23 0000002B 574841545448454655-     DB    "WHATTHEFUCK"   ; 磁盘的名称（11字节）
    24 00000034 434B               
    25 00000036 4641543132202020        DB    "FAT12   "      ; 磁盘格式名称（8字节）
    26 0000003E <res 00000012>          RESB  18              ; 先空出18字节
    27          ******************       warning: uninitialized space declared in .text section: zeroing
    28                                  
    29                                  
    30                                  ;------------------------------------------ 程序主体 ---------------------------------------------
    31                                  ; BIOS中断表参见 http://www.cnblogs.com/walfud/articles/2980774.html
    32                                  entry:
    33 00000050 B80000                    mov AX, 0
    34 00000053 8ED0                      mov SS, AX
    35 00000055 BC007C                    mov SP, 0x7c00
    36 00000058 8ED8                      mov DS, AX
    37                                  
    38 0000005A B82008                    mov AX, 0x0820              ; 将程序装载入内存中0820:0000位置（绝对地址为8200）
    39 0000005D 8EC0                      mov ES, AX                  ; ES无法被赋值为立即数, 参见
    40                                                                ; http://blog.sina.com.cn/s/blog_9407914801017rw3.html
    41 0000005F BB0000                    mov BX, 0                   ; ES:BX 表示数据缓冲区地址
    42 00000062 B500                      mov CH, 0                   ; 柱面 0
    43 00000064 B600                      mov DH, 0                   ; 磁头 0
    44 00000066 B102                      mov CL, 2                   ; 扇区 2
    45 00000068 B03F                      mov AL, 63                  ; 读入扇区数
    46                                                                ; 若要不出错误，经尝试可知最多一次连续读取63个扇区。如果考虑上引导扇区
    47                                                                ; 的话便是64个
    48 0000006A BB0000                    mov BX, 0
    49 0000006D B200                      mov DL, 0x00                ; A驱动器:如果使用虚拟机练习，此处需要特别注意是以软盘镜像启动
    50                                                                ; 还是硬盘镜像启动。若是硬盘镜像则驱动器显然并非0号（第一软驱）
    51 0000006F B402                      mov AH, 0x02                ; 中断参数：读操作
    52 00000071 CD13                      int 0x13                    ; 0x13 ：磁盘读写中断
    53 00000073 7210                      jc error
    54 00000075 EB04                      jmp success
    55                                  
    56                                  fin:                          ; 程序结束
    57 00000077 F4                        hlt
    58 00000078 E9(00C4)                  jmp 0xc400                  ; 跳入app.sys
    59                                                                ; todo 为什么跳转地址是这个?
    60                                                                ; 原书所述地址是0xc200，然而实际上由于计算机顺序向后执行命令，因此只
    61                                                                ; 要在跳转地址和实际地址之间没有多余的jmp指令，就可以正常运行。但是
    62                                                                ; 若跳转地址大于实际地址则无法正常执行
    63                                  
    64                                  success:                      ; 成功读取
    65 0000007B B8[BB00]                  mov AX, succmsg
    66 0000007E 89C5                      mov BP, AX
    67 00000080 B91100                    mov CX, succmsglen
    68 00000083 EB08                      jmp display
    69                                  error:                        ; 出现错误
    70 00000085 B8[A100]                  mov AX, errmsg
    71 00000088 89C5                      mov BP, AX
    72 0000008A B91A00                    mov CX, errmsglen
    73                                  
    74                                  ; ---------------------------- 显示信息：公用代码 ------------------------------------------------
    75                                  
    76                                  display:
    77 0000008D B80000                    mov AX, 0                   ; 不可以使用0x7c00, 由于本程序使用了 org 0x7c00指令，因此 succmsg
    78                                                                ; 或者errmsg已经从文件中的相对位置向后偏移了0x7c00
    79 00000090 8EC0                      mov ES, AX                  ; 将会显示从ES:BP开始的字符串
    80 00000092 B001                      mov AL, 0x01                ; 目标位置包含字符，且属性在BL中包含，参见
    81                                                                ; http://blog.csdn.net/pdcxs007/article/details/43378229
    82 00000094 B700                      mov BH, 0                   ; 视频区页数
    83 00000096 BA0000                    mov DX, 0                   ; DH = 行数, DL = 列数，此处显示位置为 0,0
    84 00000099 B3FC                      mov BL, 0xFC
    85 0000009B B413                      mov AH, 0x13                ; 显示中断参数：显示字符串
    86 0000009D CD10                      int 0x10                    ; 调用显示中断
    87 0000009F EBD6                      jmp fin
    88                                  
    89                                  ; ---------------------------------------- 数据段 ------------------------------------------------
    90                                  
    91                                  errmsg:
    92 000000A1 6572726F7220666F75-       db "error found while reading"
    93 000000AA 6E64207768696C6520-
    94 000000B3 72656164696E67     
    95 000000BA 0A                        db 0x0a
    96                                  errmsglen equ $ - errmsg
    97                                  succmsg:
    98 000000BB 66696E697368656420-       db "finished reading"
    99 000000C4 72656164696E67     
   100 000000CB 0A                        db 0x0a
   101                                  succmsglen equ $ - succmsg
   102                                  
   103 000000CC 00<rept>                TIMES (0x01FE-($-$$)) db 0    ; 填充当前扇区。不知道为何原文给定的填充结束位置为0x7dfe
   104                                                                ; 不过这个填充位置显然是错的，因为这样55AA标志便远在引导扇区之外
   105                                                                ; 因此我们将填充位置改为 0x01FE，因为 0x01FE + 2 = 0x0200恰好为
   106                                                                ; 第一个扇区的长度
   107 000001FE 55AA                    DB    0x55, 0xaa
